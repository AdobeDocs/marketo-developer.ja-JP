---
title: 「Marketo統合のベストプラクティス」
feature: REST API
description: Marketo API を使用するためのベストプラクティス
source-git-commit: 8c1ffb6db05da49e7377b8345eeb30472ad9b78b
workflow-type: tm+mt
source-wordcount: '952'
ht-degree: 0%

---


# Marketo統合のベストプラクティス

## API 制限

- **毎日のクォータ：** ほとんどのサブスクリプションには、1 日あたり 50,000 回の API 呼び出しが割り当てられます（毎日 12:00 にリセットされます）。 アカウントマネージャーを通じて、1 日の割り当て量を増やすことができます。
- **レート制限：** インスタンスごとの API アクセスは、20 秒あたり 100 回の呼び出しに制限されています。
- **同時実行制限：**  最大 10 回の同時 API 呼び出し。
- **バッチサイズ :** リード DB - 300 件のレコード、アセットクエリ - 200 件のレコード
- **REST API のペイロードサイズ：** 1 MB
- **一括読み込みのファイルサイズ：** 10MB
- **SOAP 最大バッチサイズ :** 300 レコード
- **一括抽出ジョブ：** 2 実行中、10 待機中（両端を含む）

## クイックヒント

- アプリケーションがクォータ、レート、および他のアプリケーションとの同時実行性リソースを競合し、保守的な使用制限を設定する場合
- 可能かつ適切な場合は、Marketoの一括処理およびバッチ処理を使用します。 必要に応じて、単一のレコードまたは単一の結果呼び出しのみを使用します。
- 使用方法 [指数関数的バックオフ](https://en.wikipedia.org/wiki/Exponential_backoff) レートまたは同時実行性の制限が原因で失敗した API 呼び出しを再試行します。
- 使用例にメリットがない場合は、同時 API 呼び出しを行わないでください。

## バッチ処理

統合に最適なパフォーマンスを確保するには、挿入または更新を実行する際に、レコードをできるだけ少ないトランザクションにグループ化する必要があります。 送信用にデータストアからレコードを取得する場合は、個々の変更に対するリクエストを送信するのではなく、送信前にレコードを常に集計する必要があります。

## 許容可能な待ち時間

待ち時間の許容値、または API 呼び出しを送信するまでに経過する最大時間を判断すると、Marketoへの統合を設計する際に行った決定の多く（大部分ではない）が通知されます。 Marketoには、様々なユースケースや様々な待ち時間クラスに適した、様々な方法および設定オプションが用意されています。 例えば、体験版にサインアップしたユーザーを営業担当者に通知するリアルタイム統合では、即時のフォローアップが必要な場合にのみ 1 つのバッチを送信できます。 ただし、ほとんどの場合は、これを必要とせず、追加の待ち時間に耐えることができ、キューとバッチ処理の呼び出しを使用してより効率的に管理できます。

| 許容可能な待ち時間 | 推奨される方法 | 注意 |
|---|---|---|
| 低（&lt;10s） | 同期 API （バッチ処理または非バッチ処理） | ユースケースでこれが必要であることを確認します。 大量のユースケースに対して即時および同期呼び出しを送信すると、毎日の API 割り当てがすぐに消費され、レートと同時実行性の両方の制限を超える可能性があります。 |
| 中（10s - 60m） | 同期 API （バッチ処理） | Marketoへのインバウンドデータ統合の場合は、年齢とサイズ制限の両方を含むキューを使用することを強くお勧めします。 いずれかの制限に達した場合は、キューをフラッシュし、累積されたレコードを使用して API リクエストを送信します。 これは、速度と効率の間の強力な妥協点であり、キューの年齢が許す限り多くのレコードをバッチ処理しながら、必要な頻度でリクエストが発生するようにします。 |
| 高（>60m） | 一括読み込み/書き出し（サポートされている場合） | インバウンドデータ統合の場合は、可能な限りレコードをキューに登録し、Marketo Bulk API を使用して送信する必要があります。 |

## 1 日の制限

Marketoの各 API 対応インスタンスには、1 日に少なくとも 10,000 回の REST API 呼び出しが毎日割り当てられますが、より一般的には 50,000 回以上、500 MB 以上のバルク抽出処理能力があります。 1 日の利用可能量の増加はMarketo サブスクリプションの一部として購入することもできますが、アプリケーションデザインでは、Marketo サブスクリプションの一般的な制限を考慮する必要があります。

インスタンスでは処理能力がすべての API サービスとユーザーで共有されるので、ベストプラクティスは冗長な呼び出しを排除し、レコードをできるだけ少ない呼び出しにバッチ化することです。 レコードを読み込む最も呼び出し効率の高い方法は、Marketoの一括読み込み API を使用することです。この API は次の場所で利用できます。 [リード/人物](https://developer.adobe.com/marketo-apis/api/mapi/#tag/Bulk-Import-Leads/operation/importLeadUsingPOST) および [カスタムオブジェクト](https://developer.adobe.com/marketo-apis/api/mapi/#tag/Snippets/operation/createSnippetUsingPOST). Marketoは、次のデータの一括抽出も提供しています： [リード数](bulk-lead-extract.md) および [アクティビティ](bulk-activity-extract.md).

### キャッシュ

次の操作の結果は、頻繁に変更されないので、通常はクライアント側で 1 日以上キャッシュできます。

- 記述操作の結果
- [アクティビティタイプ](https://developer.adobe.com/marketo-apis/api/mapi/#tag/Activities/operation/getAllActivityTypesUsingGET)
- [パーティション](https://developer.adobe.com/marketo-apis/api/mapi/#tag/Leads/operation/getLeadPartitionsUsingGET)

プログラム、メール、フォルダーなどの特定のアセットタイプのキャッシュは、リードレコードやアクティビティレコードのデータエンリッチメントなど、特定のユースケースにも適しています。

## レート制限

各Marketo インスタンスには、20 秒あたり 100 回の呼び出しのレート制限があり、これは、すべてのサードパーティの API サービスで共有されます。 この制限を超えた場合、API はレート制限を超えたことを示す 606 エラーコードを返します。 一般に、サードパーティ統合では、複数の API 統合およびユーザーによるレート制限を公平に利用できるように、使用率を 20 秒以下の呼び出し 50 回に制限する必要があります。 この上限を飽和させることが適切な場合もありますが、一般的には、バッチ処理を使用するアプリケーションでこの上限未満のスループットをターゲットにするアプリケーションの方が、動作の応答性と一貫性が高く、わずかな待ち時間の増加を伴います。

## 同時実行制限

各Marketo インスタンスには、同時に実行する REST API 呼び出しを 10 個に制限する共有されています。 1 日あたりの割り当て量とレートの制限と同様に、アプリケーションがこの制限の排他的な利用者になると想定しないでください。 Marketoは、同時呼び出しの数を、処理中でまだ返されていない呼び出しとしてカウントします。そのため、呼び出しが返されても、同時呼び出し制限に対してカウントされなくなります。

ほとんどの統合ユースケースでは、同時呼び出しを行ってもメリットはないので、Marketoに同時リクエストを送信することを決定する前に、アプリケーションでメリットがあるかどうかを検討します。 同時実行性を実装する場合は、最初の設計で同時リクエストの数を 5 個以下に制限し、アプリケーションでそれ以上の数が必要であると判断した後にのみ、この値を増やす必要があります。

## エラー

まれに発生する場合を除き、API リクエストは HTTP ステータスコード 200 を返します。 ビジネスロジックエラーも 200 を返しますが、応答の本文に詳細な情報が含まれます。 参照： [エラーコード](error-codes.md) を参照してください。 この HTTP 理由フレーズはオプションであり、変更される可能性があるので、評価しないでください。
